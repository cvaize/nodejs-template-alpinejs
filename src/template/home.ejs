<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=10.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>nodejs-template-alpinejs</title>
    <meta name="description" content="Test stand Node.js + EJS + Alpine.js">
    <meta name="keywords" content="Node.js, EJS, Alpine.js">
    <meta name="author" content="Orlov Dmitry">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body>
<div style="padding: 0 20px;">
    <h1>
        Node.js + EJS + Alpine.js
    </h1>
    Pages:
    <ul>
        <li><a href="/?<%= strParams %>" style="<%= route === '/'?'font-weight: bold':'' %>">Home</a></li>
        <li><a href="/about?<%= strParams %>" style="<%= route === '/about'?'font-weight: bold':'' %>">About</a></li>
    </ul>
    Params:
    <ul>
        <li>cache=0 - Disable cache, default: 1</li>
        <li>timeout=100 - Timeout for simulate DB, default: 0</li>
        <li>count=100 - Count Products, default: 100</li>
    </ul>
    <a href="/api">
        JSON Products with cache
    </a>
    <br>
    <a href="/">
        HTML Products with cache
    </a>
    <br>
</div>
<div x-data="{ products: [], existProducts: [] }" style="display: flex; flex-wrap: wrap"
     x-init="(await fetch('/api?<%= strParams %>')).json().then(ps => products = ps);">
    <section style="padding: 20px;"
         x-init="$nextTick(() => { existProducts = Array.from($el.querySelectorAll('li')).map(el => ({
            image: el.querySelector('img').src,
            name: el.querySelector('.js-product-name').innerText,
            description: el.querySelector('.js-product-description').innerText,
         })) });">
        <h2>Products SSR</h2>
        <ul>
            <% products.forEach(function(product, key){ %>
                <li style="margin-bottom: 10px;">
                    <div style="display: flex; justify-content: flex-start; align-items: flex-start; flex-wrap: wrap">
                        <img src="<%= product.image %>" alt="<%= product.name %>" width="60" height="40">
                        <div style="margin-left: 10px;">
                            <div class="js-product-name" style="font-weight: bold"><%= product.name %></div>
                            <div x-data="{ open: false }">
                                <button @click="open = ! open">Expand</button>

                                <div x-show="open" class="js-product-description" style="display: none;"><%= product.description %></div>
                            </div>
                        </div>
                    </div>
                </li>
            <% }); %>
        </ul>
    </section>
    <section style="padding: 20px;">
        <h2>Parse Products from existing html</h2>
        <ul>
            <template x-for="product in existProducts">
                <li style="margin-bottom: 10px;">
                    <div style="display: flex; justify-content: flex-start; align-items: flex-start; flex-wrap: wrap">
                        <img x-bind:src="product.image" x-bind:alt="product.name" width="60" height="40">
                        <div style="margin-left: 10px;">
                            <div style="font-weight: bold" x-text="product.name"></div>
                            <div x-data="{ open: false }">
                                <button @click="open = ! open">Expand</button>

                                <div x-show="open" x-text="product.description" style="display: none;"></div>
                            </div>
                        </div>
                    </div>
                </li>
            </template>
        </ul>
    </section>
    <section style="padding: 20px;">
        <h2>Fetch Products CSR</h2>
        <ul>
            <template x-for="product in products">
                <li style="margin-bottom: 10px;">
                    <div style="display: flex; justify-content: flex-start; align-items: flex-start; flex-wrap: wrap">
                        <img x-bind:src="product.image" x-bind:alt="product.name" width="60" height="40">
                        <div style="margin-left: 10px;">
                            <div style="font-weight: bold" x-text="product.name"></div>
                            <div x-data="{ open: false }">
                                <button @click="open = ! open">Expand</button>

                                <div x-show="open" x-text="product.description" style="display: none;"></div>
                            </div>
                        </div>
                    </div>
                </li>
            </template>
        </ul>
    </section>
</div>

</body>
</html>